define("sf.b2c.mall.component.login.status.scanner",["jquery","can","underscore","store"],function(e,t,n,r){return t.Control.extend({init:function(e,t){this.userLogin=!1,this.insertScanner(),this.setScanner()},insertScanner:function(){e("#proxy").length==0&&e("body").append('<iframe id="proxy" src="http://www.sfht.com/proxy.html" style="display:none;"></iframe>')},setScanner:function(){window.postMessage?this.setPostMesageScanner():this.setWindowNameScanner()},setCsrfToken:function(e){if(e)try{var t=JSON.parse(e.data),n=r.get("csrfToken");n!=t.csrfToken&&r.set("csrfToken",t.csrfToken)}catch(i){throw i}},setPostMesageScanner:function(){window.onmessage=function(){if(event)try{var e=JSON.parse(event.data),t=r.get("csrfToken");t!=e.csrfToken&&r.set("csrfToken",e.csrfToken)}catch(n){throw n}}},setWindowNameScanner:function(){var t=this;this.handler=setInterval(function(){try{var i=e("#proxy").get(0)&&e("#proxy").get(0).contentWindow.name;i&&(r.set("csrfToken",i),this.userStatus!=1&&n.isFunction(t.options.changeStatus)&&t.options.changeStatus(!0))}catch(s){}},500)}})}),define("sf.b2c.mall.widget.modal",["jquery","underscore","can"],function(e,t,n){return n.Control.extend({init:function(e,t){this.modalid=(new Date).valueOf()},show:function(e){e=t.extend(e,{id:this.modalid});var r=n.view.mustache(e&&e.template||this.template());this.element.append(r(e||this.options)),this.element.find(".modal#"+this.modalid+" .mask").show()},hide:function(){this.element.find("#"+this.modalid).remove(),this.closed=!0},isClosed:function(){return this.closed},template:function(){return'<div class="modal" id="{{id}}"><div class="mask"></div><div class="register"><div class="register-h"><h2>{{title}}</h2><a href="#" class="btn btn-close">关闭</a><span class="icon icon34"></span><span class="icon icon35"></span></div><div class="">{{&html}}</div></div></div>'},".btn-close click":function(e,t){t&&t.preventDefault(),this.hide()},setTitle:function(e){this.element.find(".register-h h2").text(e)}})}),define("sf.b2c.mall.widget.not.support",["jquery","can"],function(e,t){return t.Control.extend({init:function(){(this.isIE(6)||this.isIE(7))&&this.render()},isIE:function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",t.getElementsByTagName("i").length===1},".btn-close click":function(t,n){e(".u-dialog-browser").remove(),e(".mask").remove()},render:function(){var e=t.view("templates/widget/sf.b2c.mall.widget.not.support.mustache",{});this.element.prepend(e)}})}),define("sf.util",["jquery","jquery.cookie","can","underscore","md5","store"],function(e,t,n,r,i,s){return n.route.ready(),{checkEmail:function(e){return/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},Firefox:function(){return navigator.userAgent.indexOf("Firefox")>-1},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()||this.Firefox()}},isLogin:function(){return e.cookie("ct")==1?!0:!1},namespace:function(e){var t=e.split("."),n=sf;for(var r=0;r<t.length;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]];return n},access:function(e,t){if(e.stat.code===0&&e.content[0]&&e.stat.stateList[0].code===0)return!0;if(e.stat.code!=-180&&e.stat.code!=-360)return!1;if(t){var n=window.location.pathname;n!="/login.html"&&(window.location.href="/login.html")}},clean:function(e){return r.each(e,function(t,n,i){(r.isUndefined(t)||r.isNull(t))&&delete e[n]}),e},encrypt:function(e,t){r.each(e,function(t,n,i){r.isUndefined(t)&&delete e[n]});var n=[];r.each(e,function(e,t,r){n.push(t+"="+e)}),n.sort();var s=n.join("");return s+=t,i(s)},sign:function(e,t){var n=this,i={NONE:function(e,t){var n="sfhaitao.xyz!";return r.extend(e,{_sig:sf.util.encrypt(e,n)})},USERLOGIN:function(e,t){var i=s.get("csrfToken");if(i)return r.extend(e,{_sig:n.encrypt(e,i)});if(!t)return e;var o=window.location.pathname;o!="/login.html"&&(window.location.href="/login.html")}},o=i[e.level];if(r.isFunction(o)){var u=r.extend(e.data,{_aid:1,_sm:"md5"});return o(u)}return e.data}}}),define("sf.b2c.mall.component.header",["jquery","jquery.cookie","can","underscore","md5","store","sf.b2c.mall.component.login.status.scanner","sf.b2c.mall.framework.comm","sf.b2c.mall.api.user.getUserInfo","sf.b2c.mall.api.user.logout","sf.b2c.mall.widget.modal","sf.b2c.mall.business.config","sf.b2c.mall.widget.not.support","sf.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=1;return n.Control.extend({defaults:{login:{myOrder:c.setting.link.orderlist},nologin:{myOrder:c.setting.link.login}},init:function(t,i){this.component={},this.component.modal=new l("body"),this.component.scanner=new o,this.component.notSupport=new h("body"),this.watchLoginState.call(this),this.afterLoginDest=null;if(u.prototype.checkUserLogin.call(this)){var s=e.cookie(d+"_uinfo"),a=[];s&&(a=s.split(",")),this.data=new n.Map(r.extend(this.defaults.login,{isUserLogin:!0,index:c.setting.link.index,nickname:a[0]}))}else this.data=new n.Map(r.extend(this.defaults.nologin,{isUserLogin:!1,index:c.setting.link.index,nickname:null}));this.render(this.data);if(this.options.isForceLogin){var f=this;u.prototype.checkUserLogin.call(f)||(window.location.href=c.setting.link.index)}},render:function(e){var t=n.view("templates/component/sf.b2c.mall.header.mustache",e);this.element.html(t)},"#user-setting click":function(e,t){t&&t.preventDefault()},"#user-orderlist click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.orderlist+window.location.search+window.location.hash:this.showLogin("orderlist")},"#user-password-change click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.passwordchange:this.showLogin("passwordchange")},"#user-center click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.center:this.showLogin("center")},"#user-logout click":function(e,t){t&&t.preventDefault();var n=this;if(u.prototype.checkUserLogin.call(this)){var r=new f({});r.sendRequest().done(function(e){n.data.attr("user",null),s.remove("csrfToken"),setTimeout(function(){window.location.href=c.setting.link.index},2e3)}).fail(function(){})}},"#my-account click":function(e,t){t&&t.preventDefault()},"#user-login click":function(e,t){t&&t.preventDefault(),this.showLogin()},"#user-register click":function(e,t){t&&t.preventDefault(),this.showRegister()},showRegister:function(e){if(p.isMobile.any())return window.location.href=c.setting.link.iregister;e&&(this.afterLoginDest=e),this.component.modal.show({title:"登录顺丰海淘",html:'<iframe height="535px" width="100%" frameborder="no" seamless="" src="'+c.setting.link.register+'"></iframe>'})},showLogin:function(e){if(p.isMobile.any())return window.location.href=c.setting.link.ilogin;e&&(this.afterLoginDest=e),this.component.modal.show({title:"登录顺丰海淘",html:'<iframe height="535px" width="100%" frameborder="no" seamless="" src="'+c.setting.link.login+'"></iframe>'}),this.component.modal.setTitle("顺丰海淘")},watchLoginState:function(){var t=this;setInterval(function(){t.component.modal.isClosed()&&(t.afterLoginDest=null);if(u.prototype.checkUserLogin.call(t)){t.component.modal.isClosed()||t.component.modal.hide();if(t.afterLoginDest){var n=c.setting.link[t.afterLoginDest]||t.afterLoginDest;window.location.href=n}var r=e.cookie(d+"_uinfo"),i=[];r&&(i=r.split(",")),t.data.attr("isUserLogin",!0),t.data.attr("nickname",i[0])}else t.data.attr("isUserLogin",!1),t.data.attr("nickname",null)},500)}})}),define("sf.b2c.mall.component.footer",["can"],function(e){return e.Control.extend({init:function(t,n){var r=e.view("templates/component/sf.b2c.mall.footer.mustache")({});this.element.html(r)}})}),define("sf.b2c.mall.component.retrieve",["jquery","can","underscore","md5","sf.b2c.mall.framework.comm","sf.b2c.mall.api.user.downSmsCode","sf.b2c.mall.api.user.checkSmsCode","sf.b2c.mall.api.user.resetPassword","sf.b2c.mall.api.user.sendResetPwdLink","sf.b2c.mall.business.config"],function(e,t,n,r,i,s,o,u,a,f){var l="fillinfo",c="http://checkcode.sfht.com/captcha/",h="haitaob2c",p="5f602a27181573d36e6c9d773ce70977",d="请输入手机号",v="手机号填写有误",m="请输入验证码",g="短信验证码输入有误，请重新输入",y="密码请设置6-18位字母、数字或标点符号",b="邮箱地址格式错误",w="请输入邮箱地址",E="请输入验证码",S="验证码输入有误，请重新输入",y="密码请设置6-18位字母、数字或标点符号",x="重复密码输入有误，请重新输入",T="找回密码失败，请重试",N={MOBILE:"手机号或验证码错误",MAIL:"邮箱或验证码错误"},C={1000010:"手机号不存在",1000020:'手机号已存在，<a href="login.html">立即登陆</a>',1000070:"参数错误",1000230:"手机号错误，请输入正确的手机号",1000270:"短信请求太过频繁,请稍后重试",1000290:"短信请求太多"},k={1000230:"手机号错误，请输入正确的手机号",1000250:"验证码输入有误，请重新输入"},L={1000010:"账户名不存在",1000070:"参数错误",1000120:"链接已过期",1000130:"签名验证失败",1000140:"密码修改间隔太短",1000230:"手机号错误，请输入正确的手机号",1000240:"手机验证码错误",1000250:"验证码输入有误，请重新输入"},A={1000010:"账户名不存在",1000050:"邮箱地址错误",1000070:"参数错误",1000100:"验证码错误",1000110:"账户尚未激活",1000160:"邮件请求频繁"};return t.route.ready(),t.Control.extend({init:function(){this.component={},this.component.sms=new s,this.component.checksms=new o,this.component.resetpw=new u,this.component.sendResetPwdLink=new a,this.paint()},getVerifiedCode:function(){var t=r(Date().valueOf()+window.parseInt(Math.random()*1e4));this.data.attr("sessionId",t);var n=c+"?"+e.param({id:h,hash:p,sessionID:t});this.data.attr("verifiedCodeUrl",n)},paint:function(){this.data=new t.Map({});var e=t.route.attr("tag")||l,r=this.dataMap[e];n.isFunction(r)&&r.call(this),this.render(e,this.data)},dataMap:{fillinfo:function(){this.data.attr({mobile:!0,mail:!1,msgType:"icon26",msg:null,verifiedCodeUrl:null})}},"{can.route} change":function(){var e=t.route.attr("tag")||l,r=this.dataMap[e];n.isFunction(r)&&r.call(this),this.render.call(this,e,this.data)},renderMap:{fillinfo:"templates/component/sf.b2c.mall.component.retrieve.fillinfo.mustache",setpwd:"templates/component/sf.b2c.mall.component.retrieve.setpwd.mustache",success:"templates/component/sf.b2c.mall.component.retrieve.success.mustache"},render:function(e,n){var r=this.renderMap[e];if(r){var i=t.view(r,n);this.element.html(i)}},".radio click":function(e,t){t&&t.preventDefault();var n=e.data("tag");this.switchTab(n)},switchTab:function(e){this.data.attr("mobile",!1),this.data.attr("mail",!1),this.data.attr(e,!0),this.getVerifiedCode()},"#verified-code click":function(){this.getVerifiedCode()},checkPassword:function(e){},checkMobile:function(e){return e?/^1[0-9]{10}$/.test(e)?!0:(this.data.attr({msgType:"icon26",msg:v}),!1):(this.data.attr({msgType:"icon26",msg:d}),!1)},checkCode:function(e){return e?/^[0-9]{6}$/.test(e)?!0:(this.data.attr({msgType:"icon26",msg:g}),!1):(this.data.attr({msgType:"icon26",msg:m}),!1)},checkMailCode:function(e){return e?/^[0-9]{6}$/.test(e)?!0:(this.data.attr({msgType:"icon26",msg:S}),!1):(this.data.attr({msgType:"icon26",msg:E}),!1)},countdown:function(e){var t=this;setTimeout(function(){e>0?(e--,t.element.find("#send-code-btn").text(e+"秒后可重新发送").addClass("disable"),t.countdown.call(t,e)):t.element.find("#send-code-btn").text("发送短信验证码").removeClass("disable")},1e3)},"input focus":function(){this.data.attr("msg",null)},"#input-mobile blur":function(e,t){this.checkMobile.call(this,e.val())},"#input-sms blur":function(e,t){this.checkCode.call(this,e.val())},"#send-code-btn click":function(e,t){t&&t.preventDefault();var r=this.element.find("#input-mobile").val();if(this.checkMobile.call(this,r)){var i=this;this.component.sms.setData({mobile:r,askType:"RESETPSWD"}),this.component.sms.sendRequest().done(function(e){e.value&&(i.countdown.call(i,60),i.data.attr({msgType:"icon26",msg:null}))}).fail(function(e){if(n.isNumber(e)){var t="短信请求发送失败";i.data.attr("msgType","icon26"),i.data.attr("msg",C[e.toString()]||t)}})}},"#send-mobile-activate-btn click":function(t,r){r&&r.preventDefault();var i=this.element.find("#input-mobile").val(),s=this.element.find("#input-sms").val(),o=this;this.checkMobile.call(this,i)&&this.checkCode.call(this,s)&&(this.component.checksms.setData({mobile:i,smsCode:s,askType:"RESETPSWD"}),this.component.checksms.sendRequest().done(function(t){t.value?window.location.href=window.location.pathname+"?"+e.param({accountId:i,type:"MOBILE",sms:s})+"#!&tag=setpwd":o.data.attr({msg:N.MOBILE,msgType:"icon26"})}).fail(function(e){n.isNumber(e)?o.data.attr({msg:k[e.toString()],msgType:"icon26"}):o.data.attr({msg:T,msgType:"icon26"})}))},checkEmail:function(e){return e?/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)?!0:(this.data.attr({msg:b,msgType:"icon26"}),!1):(this.data.attr({msg:w,msgType:"icon26"}),!1)},"#input-email blur":function(e,t){var n=e.val();this.checkEmail.call(this,n)},"#nput-mail-code blur":function(e,t){var n=e.val();this.checkMailCode.call(this,n)},"#mail-resend-activate click":function(e,t){t&&t.preventDefault();var n=this.data.attr("mailId");n?(this.component.activateMail.setData({mailId:n,from:"RESEND"}),this.component.activateMail.sendRequest().done(function(e){e.value&&alert("@todo activateMail send success")}).fail(function(e){alert("@todo activateMail send fail:"+e)})):alert("@todo activateMail no mailId")},"#verified-code-btn click":function(e,t){t&&t.preventDefault(),this.getVerifiedCode()},"#input-password blur":function(e,t){var n=e.val();if(!/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(n))return this.data.attr({msg:y,msgType:"icon26"})},"#input-repassword blur":function(e,t){var r=this.element.find("#input-repassword").val(),i=this.element.find("#input-password").val();if(!/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(i))return this.data.attr({msg:y,msgType:"icon26"});if(n.isEmpty(r)||i!==r)return this.data.attr({msg:x,msgType:"icon26"})},"#reset-password-btn click":function(e,i){i&&i.preventDefault();var s=this.element.find("#input-repassword").val(),o=this.element.find("#input-password").val();if(!/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(o))return this.data.attr({msg:y,msgType:"icon26"});if(n.isEmpty(s)||o!==s)return this.data.attr({msg:x,msgType:"icon26"});var u=t.deparam(window.location.search.substr(1));u.tp=="RESETPWD"?this.component.resetpw.setData({accountId:u.mailId,type:"MAIL",newPassword:r(o+f.setting.md5_key),linkContent:window.decodeURIComponent(window.location.search.substr(1))}):this.component.resetpw.setData({accountId:u.accountId,type:u.type,newPassword:r(o+f.setting.md5_key),smsCode:u.sms});var a=this;this.component.resetpw.sendRequest().done(function(e){e.value&&t.route.attr("tag","success")}).fail(function(e){n.isNumber(e)&&a.data.attr({msg:L[e.toString()],msgType:"icon26"})})},"#send-mail-activate-btn click":function(t,r){r&&r.preventDefault();var i=this,s=this.element.find("#input-email").val(),o=this.element.find("#input-mail-code").val();this.checkEmail(s)&&this.checkMailCode(o)&&(o=e.param({id:h,hash:p,sessionID:this.data.sessionId,answer:o}),this.component.sendResetPwdLink.setData({mailId:s,vfCode:o}),this.component.sendResetPwdLink.sendRequest().done(function(e){e.value?i.data.attr({msg:"邮件已发送至您的邮箱，请查收",msgType:"icon26-2"}):i.data.attr({msg:N.MAIL,msgType:"icon26"})}).fail(function(e){i.getVerifiedCode(),n.isNumber(e)&&i.data.attr({msg:A[e.toString()],msgType:"icon26"})}))}})}),define("sf.b2c.mall.page.retrieve",["jquery","can","underscore","sf.b2c.mall.framework.comm","sf.b2c.mall.component.header","sf.b2c.mall.component.footer","sf.b2c.mall.component.retrieve"],function(e,t,n,r,i,s,o){r.register(1);var u=t.Control.extend({init:function(){this.component={},this.paint()},paint:function(){this.component.header=new i(".sf-b2c-mall-header"),this.component.footer=new s(".sf-b2c-mall-footer"),this.component.retrieve=new o(".sf-b2c-mall-content")}}),a=new u("body")}),require(["sf.b2c.mall.page.retrieve"]);