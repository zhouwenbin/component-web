(function(e){function t(e,t,n){if(e.addEventListener)return e.addEventListener(t,n,!1);if(e.attachEvent)return e.attachEvent("on"+t,n)}function n(e,t){var n,r;for(n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1}function r(e,t){var n;e.createTextRange?(n=e.createTextRange(),n.move("character",t),n.select()):e.selectionStart&&(e.focus(),e.setSelectionRange(t,t))}function i(e,t){try{return e.type=t,!0}catch(n){return!1}}e.Placeholders={Utils:{addEventListener:t,inArray:n,moveCaret:r,changeType:i}}})(this),function(e){function _(){}function D(){try{return document.activeElement}catch(e){}}function P(e,t){var n,r,i=!!t&&e.value!==t,o=e.value===e.getAttribute(a);return(i||o)&&e.getAttribute(f)==="true"?(e.removeAttribute(f),e.value=e.value.replace(e.getAttribute(a),""),e.className=e.className.replace(s,""),r=e.getAttribute(v),parseInt(r,10)>=0&&(e.setAttribute("maxLength",r),e.removeAttribute(v)),n=e.getAttribute(l),n&&(e.type=n),!0):!1}function H(e){var t,n,r=e.getAttribute(a);return e.value===""&&r?(e.setAttribute(f,"true"),e.value=r,e.className+=" "+i,n=e.getAttribute(v),n||(e.setAttribute(v,e.maxLength),e.removeAttribute("maxLength")),t=e.getAttribute(l),t?e.type="text":e.type==="password"&&w.changeType(e,"text")&&e.setAttribute(l,"password"),!0):!1}function B(e,t){var n,r,i,s,f,l,c;if(e&&e.getAttribute(a))t(e);else{i=e?e.getElementsByTagName("input"):o,s=e?e.getElementsByTagName("textarea"):u,n=i?i.length:0,r=s?s.length:0;for(c=0,l=n+r;c<l;c++)f=c<n?i[c]:s[c-n],t(f)}}function j(e){B(e,P)}function F(e){B(e,H)}function I(e){return function(){E&&e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"?w.moveCaret(e,0):P(e)}}function q(e){return function(){H(e)}}function R(e){return function(t){x=e.value;if(e.getAttribute(f)==="true"&&x===e.getAttribute(a)&&w.inArray(n,t.keyCode))return t.preventDefault&&t.preventDefault(),!1}}function U(e){return function(){P(e,x),e.value===""&&(e.blur(),w.moveCaret(e,0))}}function z(e){return function(){e===D()&&e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"&&w.moveCaret(e,0)}}function W(e){return function(){j(e)}}function X(e){e.form&&(L=e.form,typeof L=="string"&&(L=document.getElementById(L)),L.getAttribute(c)||(w.addEventListener(L,"submit",W(L)),L.setAttribute(c,"true"))),w.addEventListener(e,"focus",I(e)),w.addEventListener(e,"blur",q(e)),E&&(w.addEventListener(e,"keydown",R(e)),w.addEventListener(e,"keyup",U(e)),w.addEventListener(e,"click",z(e))),e.setAttribute(h,"true"),e.setAttribute(a,C),(E||e!==D())&&H(e)}var t=["text","search","url","tel","email","password","number","textarea"],n=[27,33,34,35,36,37,38,39,40,8,46],r="#ccc",i="placeholdersjs",s=new RegExp("(?:^|\\s)"+i+"(?!\\S)"),o,u,a="data-placeholder-value",f="data-placeholder-active",l="data-placeholder-type",c="data-placeholder-submit",h="data-placeholder-bound",p="data-placeholder-focus",d="data-placeholder-live",v="data-placeholder-maxlength",m=document.createElement("input"),g=document.getElementsByTagName("head")[0],y=document.documentElement,b=e.Placeholders,w=b.Utils,E,S,x,T,N,C,k,L,A,O,M;b.nativeSupport=m.placeholder!==void 0;if(!b.nativeSupport){o=document.getElementsByTagName("input"),u=document.getElementsByTagName("textarea"),E=y.getAttribute(p)==="false",S=y.getAttribute(d)!=="false",T=document.createElement("style"),T.type="text/css",N=document.createTextNode("."+i+" { color:"+r+"; }"),T.styleSheet?T.styleSheet.cssText=N.nodeValue:T.appendChild(N),g.insertBefore(T,g.firstChild);for(M=0,O=o.length+u.length;M<O;M++)A=M<o.length?o[M]:u[M-o.length],C=A.attributes.placeholder,C&&(C=C.nodeValue,C&&w.inArray(t,A.type)&&X(A));k=setInterval(function(){for(M=0,O=o.length+u.length;M<O;M++){A=M<o.length?o[M]:u[M-o.length],C=A.attributes.placeholder;if(C){C=C.nodeValue;if(C&&w.inArray(t,A.type)){A.getAttribute(h)||X(A);if(C!==A.getAttribute(a)||A.type==="password"&&!A.getAttribute(l))A.type==="password"&&!A.getAttribute(l)&&w.changeType(A,"text")&&A.setAttribute(l,"password"),A.value===A.getAttribute(a)&&(A.value=C),A.setAttribute(a,C)}}else A.getAttribute(f)&&(P(A),A.removeAttribute(a))}S||clearInterval(k)},100)}w.addEventListener(e,"beforeunload",function(){b.disable()}),b.disable=b.nativeSupport?_:j,b.enable=b.nativeSupport?_:F}(this),define("placeholders",function(){}),define("sf.util",["jquery","jquery.cookie","can","underscore","md5","store"],function(e,t,n,r,i,s){return n.route.ready(),{checkEmail:function(e){return/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},Firefox:function(){return navigator.userAgent.indexOf("Firefox")>-1},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()||this.Firefox()}},isLogin:function(){return e.cookie("ct")==1?!0:!1},namespace:function(e){var t=e.split("."),n=sf;for(var r=0;r<t.length;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]];return n},access:function(e,t){if(e.stat.code===0&&e.content[0]&&e.stat.stateList[0].code===0)return!0;if(e.stat.code!=-180&&e.stat.code!=-360)return!1;if(t){var n=window.location.pathname;n!="/login.html"&&(window.location.href="/login.html")}},clean:function(e){return r.each(e,function(t,n,i){(r.isUndefined(t)||r.isNull(t))&&delete e[n]}),e},encrypt:function(e,t){r.each(e,function(t,n,i){r.isUndefined(t)&&delete e[n]});var n=[];r.each(e,function(e,t,r){n.push(t+"="+e)}),n.sort();var s=n.join("");return s+=t,i(s)},sign:function(e,t){var n=this,i={NONE:function(e,t){var n="sfhaitao.xyz!";return r.extend(e,{_sig:sf.util.encrypt(e,n)})},USERLOGIN:function(e,t){var i=s.get("csrfToken");if(i)return r.extend(e,{_sig:n.encrypt(e,i)});if(!t)return e;var o=window.location.pathname;o!="/login.html"&&(window.location.href="/login.html")}},o=i[e.level];if(r.isFunction(o)){var u=r.extend(e.data,{_aid:1,_sm:"md5"});return o(u)}return e.data}}}),define("sf.b2c.mall.component.register",["jquery","can","md5","underscore","store","placeholders","sf.b2c.mall.api.user.downSmsCode","sf.b2c.mall.api.user.mobileRegister","sf.b2c.mall.api.user.sendActivateMail","sf.b2c.mall.business.config","sf.util"],function(e,t,n,r,i,s,o,u,a,f,l){var c="fillinfo",h="http://checkcode.sfht.com/captcha/",p="haitaob2c",d="5f602a27181573d36e6c9d773ce70977",v={1000020:'邮箱地址已存在，<a href="login.html">立即登录</a>',1000050:"邮箱地址错误",1000070:"参数错误",1000100:"验证码错误",1000160:"邮件请求频繁"},m={1000010:"未找到手机用户",1000020:'手机号已存在，<a href="login.html">立即登录</a>',1000070:"参数错误",1000230:"手机号错误，请输入正确的手机号",1000270:"短信请求太过频繁,请稍后重试",1000290:"短信请求太多"},g={1000020:'手机号已存在，<a href="login.html">立即登录</a>',1000230:"手机号错误，请输入正确的手机号",1000240:"手机验证码错误",1000250:"验证码输入有误，请重新输入"},y="请输入您的手机号码",b="您的手机号码格式有误",w="请输入验证码",E="短信验证码输入有误，请重新输入",S="请设置登录密码",x="密码请设置6-18位字母、数字或标点符号",T="邮箱格式有误",N="请输入您的常用邮箱地址",C="请输入右侧图片中信息",k="验证码输入有误，请重新输入",L="验证邮件已重新发送，请注意查收",A={163:"http://mail.163.com",qq:"http://mail.qq.com",sina:"http://mail.sina.com.cn",sohu:"http://mail.sohu.com","21cn":"http://mail.21cn.com",hotmail:"http://www.hotmail.com",gmail:"https://mail.google.com",126:"http://mail.126.com/"};return t.route.ready(),t.Control.extend({helpers:{ismobile:function(e,t){return e()=="mobile"?t.fn(t.contexts||this):t.inverse(t.contexts||this)}},init:function(e,n){this.component={},this.component.sms=new o,this.component.mobileRegister=new u,this.component.activateMail=new a,this.data=new t.Map({mobile:!0,mail:!1,timmer:2});var r=t.route.attr("tag")||c;this.render(r,this.data)},"{can.route} change":function(){var e=t.route.attr("tag")||c;this.render.call(this,e,this.data)},renderMap:{fillinfo:function(e){var n=t.view("templates/component/sf.b2c.mall.component.register.fillinfo.mustache",e,this.helpers);this.element.html(n),this.element.find(".register").fadeIn("slow")},success:function(e){var n=this,r=t.view("templates/component/sf.b2c.mall.component.register.success.mustache",e,this.helpers);this.element.html(r),this.element.find(".register").fadeIn("slow",function(){n.timmer.call(n)})},confirminfo:function(e){var n=t.deparam(window.location.search.substr(1));e.attr("mailId",n.mailId),e.attr("mailLink",this.getEmailLink(n.mailId)),e.attr("msg",null),e.attr("msgType","icon26-2");var r=t.view("templates/component/sf.b2c.mall.component.register.confirminfo.mustache",e,this.helpers);this.element.html(r),this.element.find(".register").fadeIn("slow")}},render:function(e,n){var i=t.deparam(window.location.search.substr(1)),s=this.renderMap[e];r.isFunction(s)&&((l.isMobile.any()||i.platform)&&n.attr("platform",i.platform||(l.isMobile.any()?"mobile":null)),s.call(this,n))},timmer:function(){var e=this;setTimeout(function(){var n=e.data.attr("timmer");if(n>1)e.data.attr("timmer",n-1),e.timmer.call(e);else{var s=t.route.attr("csrfToken");i.set("csrfToken",s),r.isFunction(e.options.onRegistered)&&e.options.onRegistered()}},1e3)},getEmailLink:function(e){if(e){var t=e.split("@"),n=t[1].split("."),r=A[n[0].toLowerCase()];return r}},switchTag:function(e){var t=this;r.each(this.data.attr(),function(e,n){t.data.attr(n,!1)}),this.data.attr(e,!0),e=="mail"&&this.getVerifiedCode.call(this)},checkMobile:function(e){return e?/^1[0-9]{10}$/.test(e)?!0:(this.element.find("#input-mobile-error").text(b).show(),!1):(this.element.find("#input-mobile-error").text(y).show(),!1)},checkCode:function(e){return e?/^[0-9]{6}$/.test(e)?!0:(this.element.find("#mobile-code-error").text(E).show(),!1):(this.element.find("#mobile-code-error").text(w).show(),!1)},checkMailCode:function(e){return e?/^[0-9]{6}$/.test(e)?!0:(this.element.find("#mail-code-error").text(k).show(),!1):(this.element.find("#mail-code-error").text(C).show(),!1)},checkPassword:function(e,t){return e?/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(e)?!0:(this.element.find(t).text(x).show(),!1):(this.element.find(t).text(S).show(),!1)},checkEmail:function(e){return e?/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)?!0:(this.element.find("#input-mail-error").text(T).show(),!1):(this.element.find("#input-mail-error").text(N).show(),!1)},".register-h ul li click":function(e,t){t&&t.preventDefault();var n=e.data("tag");this.switchTag(n)},"#input-mobile blur":function(e,t){var n=e.val();this.checkMobile.call(this,n)},"#input-mobile focus":function(e,t){this.element.find("#input-mobile-error").hide()},countdown:function(e){var t=this;setTimeout(function(){e>0?(e--,t.element.find("#mobile-code-btn").text(e+"秒后可重新发送").addClass("disable"),t.countdown.call(t,e)):t.element.find("#mobile-code-btn").text("发送短信验证码").removeClass("disable")},1e3)},"#mobile-code-btn click":function(e,t){t&&t.preventDefault();var n=this.element.find("#input-mobile").val();if(this.checkMobile.call(this,n)){var i=this;this.component.sms.setData({mobile:n,askType:"REGISTER"}),this.component.sms.sendRequest().done(function(e){i.countdown.call(i,60),i.element.find("#mobile-code-error").hide()}).fail(function(e){if(r.isNumber(e)){var t="短信请求发送失败",n=m[e.toString()]||t;e===1000020?i.element.find("#input-mobile-error").html(n).show():i.element.find("#mobile-code-error").html(n).show()}})}},"input focus":function(e,t){this.element.find("#input-mobile-error").hide()},"#input-mobile-code focus":function(e,t){this.element.find("#mobile-code-error").hide()},"#input-mobile-code blur":function(e,t){var n=this.element.find("#input-mobile-code").val();this.checkCode.call(this,n)},"#input-password blur":function(t,n){var r=t.val();r?t.val(r):e("#pwd-default-text").show(),this.checkPassword.call(this,r,"#password-error")},"#input-password focus":function(t,n){e("#pwd-default-text").hide(),this.element.find("#password-error").hide()},"#mobile-register-btn click":function(e,i){i&&i.preventDefault();var s=this,o=this.element.find("#input-mobile").val(),u=this.element.find("#input-mobile-code").val(),a=this.element.find("#input-password").val();this.checkMobile.call(this,o)&&this.checkCode(u)&&this.checkPassword(a,"#password-error")&&(this.component.mobileRegister.setData({mobile:o,smsCode:u,password:n(a+f.setting.md5_key)}),this.component.mobileRegister.sendRequest().done(function(e){e.csrfToken&&t.route.attr({tag:"success",csrfToken:e.csrfToken})}).fail(function(e){if(r.isNumber(e)){var t="注册失败",n=g[e.toString()]||t;e==1000020?s.element.find("#input-mobile-error").html(n).show():s.element.find("#mobile-register-error").html(n).show()}}))},"#input-mail focus":function(e,t){this.element.find("#input-mail-error").hide()},"#input-mail blur":function(e,t){var n=e.val();this.checkEmail.call(this,n)},getVerifiedCode:function(){var t=n(Date().valueOf()+window.parseInt(Math.random()*1e4));this.data.attr("sessionId",t);var r=h+"?"+e.param({id:p,hash:d,sessionID:t});this.data.attr("verifiedCodeUrl",r)},"#verified-code-btn click":function(){this.getVerifiedCode()},"#input-mail-code focus":function(e,t){this.element.find("#mail-code-error").hide()},"#input-mail-code blur":function(e,t){var n=e.val();this.checkMailCode.call(this,n)},"#input-mail-password focus":function(e,t){this.element.find("#mail-password-error").hide()},"#input-mail-password blur":function(e,t){var n=e.val();this.checkPassword.call(this,n,"#mail-password-error")},"#mail-resend-activate click":function(e,t){t&&t.preventDefault();var n=this.data.attr("mailId");this.component.activateMail.setData({mailId:n,from:"RESEND"});var i=this;this.component.activateMail.sendRequest().done(function(e){e.value&&(i.data.attr("msgType","icon26-2"),i.data.attr("msg",L))}).fail(function(e){i.getVerifiedCode();if(r.isNumber(e)){i.data.attr("msgType","icon26");var t=v[e.toString()];e==1000020?i.element.find("#input-mobile-error").html(t).show():i.data.attr("msg",t)}})},"#mail-register-btn click":function(t,n){n&&n.preventDefault();var i=this,s=this.element.find("#input-mail").val(),o=this.element.find("#input-mail-code").val();this.checkEmail.call(this,s)&&this.checkMailCode.call(this,o)&&(o=e.param({id:p,hash:d,sessionID:this.data.sessionId,answer:o}),this.component.activateMail.setData({mailId:s,vfCode:o}),this.component.activateMail.sendRequest().done(function(t){t.value&&(window.location.href=f.setting.link.register+"?"+e.param({mailId:s})+"#!&tag=confirminfo")}).fail(function(e){i.getVerifiedCode();if(r.isNumber(e)){var t="注册失败";i.element.find("#mail-register-error").html(v[e.toString()]||t).show()}}))}})}),define("sf.b2c.mall.page.register",["jquery","can","sf.b2c.mall.component.register","sf.b2c.mall.framework.comm"],function(e,t,n,r){r.register(1);var i=new n("body")}),require(["sf.b2c.mall.page.register"]);