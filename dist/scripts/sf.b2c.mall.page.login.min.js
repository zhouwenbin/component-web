define("sf.util",["jquery","jquery.cookie","can","underscore","md5","store"],function(e,t,n,r,i,s){return n.route.ready(),{checkEmail:function(e){return/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},Firefox:function(){return navigator.userAgent.indexOf("Firefox")>-1},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()||this.Firefox()}},isLogin:function(){return e.cookie("ct")==1?!0:!1},namespace:function(e){var t=e.split("."),n=sf;for(var r=0;r<t.length;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]];return n},access:function(e,t){if(e.stat.code===0&&e.content[0]&&e.stat.stateList[0].code===0)return!0;if(e.stat.code!=-180&&e.stat.code!=-360)return!1;if(t){var n=window.location.pathname;n!="/login.html"&&(window.location.href="/login.html")}},clean:function(e){return r.each(e,function(t,n,i){(r.isUndefined(t)||r.isNull(t))&&delete e[n]}),e},encrypt:function(e,t){r.each(e,function(t,n,i){r.isUndefined(t)&&delete e[n]});var n=[];r.each(e,function(e,t,r){n.push(t+"="+e)}),n.sort();var s=n.join("");return s+=t,i(s)},sign:function(e,t){var n=this,i={NONE:function(e,t){var n="sfhaitao.xyz!";return r.extend(e,{_sig:sf.util.encrypt(e,n)})},USERLOGIN:function(e,t){var i=s.get("csrfToken");if(i)return r.extend(e,{_sig:n.encrypt(e,i)});if(!t)return e;var o=window.location.pathname;o!="/login.html"&&(window.location.href="/login.html")}},o=i[e.level];if(r.isFunction(o)){var u=r.extend(e.data,{_aid:1,_sm:"md5"});return o(u)}return e.data}}}),define("sf.b2c.mall.component.login",["jquery","can","md5","store","sf.b2c.mall.business.config","sf.b2c.mall.api.user.webLogin","sf.b2c.mall.api.user.needVfCode","sf.util"],function(e,t,n,r,i,s,o,u){var a="http://checkcode.sfht.com/captcha/",f="haitaob2c",l="5f602a27181573d36e6c9d773ce70977",c=0,h="请输入顺丰海淘帐号",p="账户有误，请重新输入",d="请输入密码",v="密码有误，请重新输入",m="请输入验证码",g="您的验证码输入有误，请重新输入";return t.Control.extend({helpers:{ismobile:function(e,t){return e()=="mobile"?t.fn(t.contexts||this):t.inverse(t.contexts||this)}},init:function(){this.component={},this.component.login=new s,this.component.needVfCode=new o;var e=t.deparam(window.location.search.substr(1));this.data=new t.Map({username:null,password:null,verifiedCode:null,isNeedVerifiedCode:!1,verifiedCodeUrl:null,autologin:!1,sessionId:null,platform:e.platform||(u.isMobile.any()?"mobile":null),isPlaceholderSupport:this.isPlaceholderSupport()}),this.render(this.data),this.getVerifiedCode()},isPlaceholderSupport:function(){return"placeholder"in document.createElement("input")},render:function(e){var n=t.view("templates/component/sf.b2c.mall.component.login.mustache",e,this.helpers);this.element.append(n),c>=3&&this.data.attr("isNeedVerifiedCode",!0),this.funPlaceholder(document.getElementById("user-name"))},getVerifiedCode:function(){var t=n(Date().valueOf()+window.parseInt(Math.random()*1e4));this.data.attr("sessionId",t);var r=a+"?"+e.param({id:f,hash:l,sessionID:t});this.data.attr("verifiedCodeUrl",r)},"#verified-code-btn click":function(e,t){t&&t.preventDefault(),this.getVerifiedCode()},checkUserName:function(t){var t=e.trim(t),n=/^1\d{10}$/.test(t),r=/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(t);return t?t.length>30?(this.element.find("#username-error-tips").text(p).show(),!1):!n&&!r?(this.element.find("#username-error-tips").text(p).show(),!1):!0:(this.element.find("#username-error-tips").text(h).show(),!1)},checkPwd:function(t){var t=e.trim(t),n=/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(t);return t?t.length>30||!n?(this.element.find("#pwd-error-tips").text(v).show(),!1):!0:(this.element.find("#pwd-error-tips").text(d).show(),!1)},checkVerCode:function(t){var t=e.trim(t),n=/^\d{6}$/.test(t);return t?t.length>30||!n?(this.element.find("#code-error-tips").text(g).show(),!1):!0:(this.element.find("#code-error-tips").text(m).show(),!1)},isNeedVerCode:function(){var e=this.data.attr("username"),t=this;this.component.needVfCode.setData({accountId:e}),this.component.needVfCode.sendRequest().done(function(e){e.value?t.data.attr("isNeedVerifiedCode",!0):t.data.attr("isNeedVerifiedCode",!1)}).fail(function(e){})},funPlaceholder:function(e){var t="";e&&!("placeholder"in document.createElement("input"))&&(t=e.getAttribute("placeholder"))&&(e.onfocus=function(){this.value===t&&(this.value="")},e.onblur=function(){this.value===""&&(this.value=t)},e.value===""&&(e.value=t))},checkTypeOfAccount:function(t){t=e.trim(t);var n=/^1\d{10}$/.test(t),r=/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(t);if(n)return"MOBILE";if(r)return"MAIL"},".input-username keyup":function(e,t){t&&t.preventDefault(),this.element.find("#username-error-tips").hide()},".input-password keyup":function(t,n){n&&n.preventDefault(),this.element.find("#pwd-error-tips").hide(),e(t).siblings("label").hide()},".input-username blur":function(e,t){t&&t.preventDefault();var n=this.data.attr("username");this.checkUserName.call(this,n),this.isNeedVerCode()},".input-password blur":function(t,n){n&&n.preventDefault();var r=e(t).val();r?e(t).siblings("label").hide():e(t).siblings("label").show(),this.checkPwd.call(this,r)},"#user-name focus":function(t,n){e("#username-error-tips").hide()},"#user-pwd focus":function(t,n){e("#pwd-error-tips").hide()},"input focus":function(t,n){e("#code-error-tips").hide()},sendRequest:function(){var n=this;document.domain=window.location.host,this.component.login.sendRequest().done(function(e){if(e.userId){n.data.attr("autologin");var r=t.deparam(window.location.search.substr(1))}}).fail(function(t){var r={"-140":"账户名或登录密码错误，请重新输入",1000010:"账户未注册，立即注册",1000030:"账户名或登录密码错误，请重新输入",1000070:"账户名或登录密码错误，请重新输入",1000100:"验证码错误",1000110:"账户尚未激活",1000300:"密码输入超过三次"},i=r[t.toString()];t===1000100?e("#code-error-tips").text(i).show():t===1000300?(n.data.attr("isNeedVerifiedCode",!0),e("#username-error-tips").text("账户名或登录密码错误，请重新输入").show()):e("#username-error-tips").text(i).show()})},".btn-register click":function(t,r){r&&r.preventDefault();var s=this,o=e("#user-name").val(),u=e("#user-pwd").val(),a=e("#verified-code").val();e("#username-error-tips").hide(),e("#pwd-error-tips").hide(),e("#code-error-tips").hide();if(this.data.attr("isNeedVerifiedCode")){if(this.checkUserName.call(this,o)&&this.checkPwd.call(this,u)&&this.checkVerCode.call(this,a)){var c=e.param({id:f,hash:l,sessionID:this.data.sessionId,answer:this.data.attr("verifiedCode")});this.component.login.setData({accountId:e.trim(this.data.attr("username")),type:this.checkTypeOfAccount(this.data.attr("username")),password:n(this.data.attr("password")+i.setting.md5_key),vfCode:c}),s.sendRequest(),s.getVerifiedCode()}}else this.checkUserName.call(this,o)&&this.checkPwd.call(this,u)&&(this.component.login.setData({accountId:e.trim(this.data.attr("username")),type:this.checkTypeOfAccount(this.data.attr("username")),password:n(this.data.attr("password")+i.setting.md5_key)}),s.sendRequest())}})}),define("sf.b2c.mall.page.login",["jquery","can","sf.b2c.mall.framework.comm","sf.b2c.mall.component.login"],function(e,t,n,r){n.register(1);var i=t.Control.extend({init:function(){this.component={},this.render(),this.supplement()},render:function(){new r("body")},supplement:function(){e(".register .btn-close").on("click",function(){return e(this).parents(".register").hide(300),e(".mask").hide(),!1}),e(".input-password").focus(function(){e(".icon34").animate({top:-28},700)}),e(".input-password").blur(function(){e(".icon34").animate({top:-78},300).animate({top:-74},50).animate({top:-76},50)})}});new i("body")}),require(["sf.b2c.mall.page.login"]);