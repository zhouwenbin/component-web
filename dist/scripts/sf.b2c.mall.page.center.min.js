(function(e){function t(e,t,n){if(e.addEventListener)return e.addEventListener(t,n,!1);if(e.attachEvent)return e.attachEvent("on"+t,n)}function n(e,t){var n,r;for(n=0,r=e.length;n<r;n++)if(e[n]===t)return!0;return!1}function r(e,t){var n;e.createTextRange?(n=e.createTextRange(),n.move("character",t),n.select()):e.selectionStart&&(e.focus(),e.setSelectionRange(t,t))}function i(e,t){try{return e.type=t,!0}catch(n){return!1}}e.Placeholders={Utils:{addEventListener:t,inArray:n,moveCaret:r,changeType:i}}})(this),function(e){function _(){}function D(){try{return document.activeElement}catch(e){}}function P(e,t){var n,r,i=!!t&&e.value!==t,o=e.value===e.getAttribute(a);return(i||o)&&e.getAttribute(f)==="true"?(e.removeAttribute(f),e.value=e.value.replace(e.getAttribute(a),""),e.className=e.className.replace(s,""),r=e.getAttribute(v),parseInt(r,10)>=0&&(e.setAttribute("maxLength",r),e.removeAttribute(v)),n=e.getAttribute(l),n&&(e.type=n),!0):!1}function H(e){var t,n,r=e.getAttribute(a);return e.value===""&&r?(e.setAttribute(f,"true"),e.value=r,e.className+=" "+i,n=e.getAttribute(v),n||(e.setAttribute(v,e.maxLength),e.removeAttribute("maxLength")),t=e.getAttribute(l),t?e.type="text":e.type==="password"&&w.changeType(e,"text")&&e.setAttribute(l,"password"),!0):!1}function B(e,t){var n,r,i,s,f,l,c;if(e&&e.getAttribute(a))t(e);else{i=e?e.getElementsByTagName("input"):o,s=e?e.getElementsByTagName("textarea"):u,n=i?i.length:0,r=s?s.length:0;for(c=0,l=n+r;c<l;c++)f=c<n?i[c]:s[c-n],t(f)}}function j(e){B(e,P)}function F(e){B(e,H)}function I(e){return function(){E&&e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"?w.moveCaret(e,0):P(e)}}function q(e){return function(){H(e)}}function R(e){return function(t){x=e.value;if(e.getAttribute(f)==="true"&&x===e.getAttribute(a)&&w.inArray(n,t.keyCode))return t.preventDefault&&t.preventDefault(),!1}}function U(e){return function(){P(e,x),e.value===""&&(e.blur(),w.moveCaret(e,0))}}function z(e){return function(){e===D()&&e.value===e.getAttribute(a)&&e.getAttribute(f)==="true"&&w.moveCaret(e,0)}}function W(e){return function(){j(e)}}function X(e){e.form&&(L=e.form,typeof L=="string"&&(L=document.getElementById(L)),L.getAttribute(c)||(w.addEventListener(L,"submit",W(L)),L.setAttribute(c,"true"))),w.addEventListener(e,"focus",I(e)),w.addEventListener(e,"blur",q(e)),E&&(w.addEventListener(e,"keydown",R(e)),w.addEventListener(e,"keyup",U(e)),w.addEventListener(e,"click",z(e))),e.setAttribute(h,"true"),e.setAttribute(a,C),(E||e!==D())&&H(e)}var t=["text","search","url","tel","email","password","number","textarea"],n=[27,33,34,35,36,37,38,39,40,8,46],r="#ccc",i="placeholdersjs",s=new RegExp("(?:^|\\s)"+i+"(?!\\S)"),o,u,a="data-placeholder-value",f="data-placeholder-active",l="data-placeholder-type",c="data-placeholder-submit",h="data-placeholder-bound",p="data-placeholder-focus",d="data-placeholder-live",v="data-placeholder-maxlength",m=document.createElement("input"),g=document.getElementsByTagName("head")[0],y=document.documentElement,b=e.Placeholders,w=b.Utils,E,S,x,T,N,C,k,L,A,O,M;b.nativeSupport=m.placeholder!==void 0;if(!b.nativeSupport){o=document.getElementsByTagName("input"),u=document.getElementsByTagName("textarea"),E=y.getAttribute(p)==="false",S=y.getAttribute(d)!=="false",T=document.createElement("style"),T.type="text/css",N=document.createTextNode("."+i+" { color:"+r+"; }"),T.styleSheet?T.styleSheet.cssText=N.nodeValue:T.appendChild(N),g.insertBefore(T,g.firstChild);for(M=0,O=o.length+u.length;M<O;M++)A=M<o.length?o[M]:u[M-o.length],C=A.attributes.placeholder,C&&(C=C.nodeValue,C&&w.inArray(t,A.type)&&X(A));k=setInterval(function(){for(M=0,O=o.length+u.length;M<O;M++){A=M<o.length?o[M]:u[M-o.length],C=A.attributes.placeholder;if(C){C=C.nodeValue;if(C&&w.inArray(t,A.type)){A.getAttribute(h)||X(A);if(C!==A.getAttribute(a)||A.type==="password"&&!A.getAttribute(l))A.type==="password"&&!A.getAttribute(l)&&w.changeType(A,"text")&&A.setAttribute(l,"password"),A.value===A.getAttribute(a)&&(A.value=C),A.setAttribute(a,C)}}else A.getAttribute(f)&&(P(A),A.removeAttribute(a))}S||clearInterval(k)},100)}w.addEventListener(e,"beforeunload",function(){b.disable()}),b.disable=b.nativeSupport?_:j,b.enable=b.nativeSupport?_:F}(this),define("placeholders",function(){}),define("sf.b2c.mall.component.login.status.scanner",["jquery","can","underscore","store"],function(e,t,n,r){return t.Control.extend({init:function(e,t){this.userLogin=!1,this.insertScanner(),this.setScanner()},insertScanner:function(){e("#proxy").length==0&&e("body").append('<iframe id="proxy" src="http://www.sfht.com/proxy.html" style="display:none;"></iframe>')},setScanner:function(){window.postMessage?this.setPostMesageScanner():this.setWindowNameScanner()},setCsrfToken:function(e){if(e)try{var t=JSON.parse(e.data),n=r.get("csrfToken");n!=t.csrfToken&&r.set("csrfToken",t.csrfToken)}catch(i){throw i}},setPostMesageScanner:function(){window.onmessage=function(){if(event)try{var e=JSON.parse(event.data),t=r.get("csrfToken");t!=e.csrfToken&&r.set("csrfToken",e.csrfToken)}catch(n){throw n}}},setWindowNameScanner:function(){var t=this;this.handler=setInterval(function(){try{var i=e("#proxy").get(0)&&e("#proxy").get(0).contentWindow.name;i&&(r.set("csrfToken",i),this.userStatus!=1&&n.isFunction(t.options.changeStatus)&&t.options.changeStatus(!0))}catch(s){}},500)}})}),define("sf.b2c.mall.widget.modal",["jquery","underscore","can"],function(e,t,n){return n.Control.extend({init:function(e,t){this.modalid=(new Date).valueOf()},show:function(e){e=t.extend(e,{id:this.modalid});var r=n.view.mustache(e&&e.template||this.template());this.element.append(r(e||this.options)),this.element.find(".modal#"+this.modalid+" .mask").show()},hide:function(){this.element.find("#"+this.modalid).remove(),this.closed=!0},isClosed:function(){return this.closed},template:function(){return'<div class="modal" id="{{id}}"><div class="mask"></div><div class="register"><div class="register-h"><h2>{{title}}</h2><a href="#" class="btn btn-close">关闭</a><span class="icon icon34"></span><span class="icon icon35"></span></div><div class="">{{&html}}</div></div></div>'},".btn-close click":function(e,t){t&&t.preventDefault(),this.hide()},setTitle:function(e){this.element.find(".register-h h2").text(e)}})}),define("sf.b2c.mall.widget.not.support",["jquery","can"],function(e,t){return t.Control.extend({init:function(){(this.isIE(6)||this.isIE(7))&&this.render()},isIE:function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",t.getElementsByTagName("i").length===1},".btn-close click":function(t,n){e(".u-dialog-browser").remove(),e(".mask").remove()},render:function(){var e=t.view("templates/widget/sf.b2c.mall.widget.not.support.mustache",{});this.element.prepend(e)}})}),define("sf.util",["jquery","jquery.cookie","can","underscore","md5","store"],function(e,t,n,r,i,s){return n.route.ready(),{checkEmail:function(e){return/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},Firefox:function(){return navigator.userAgent.indexOf("Firefox")>-1},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()||this.Firefox()}},isLogin:function(){return e.cookie("ct")==1?!0:!1},namespace:function(e){var t=e.split("."),n=sf;for(var r=0;r<t.length;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]];return n},access:function(e,t){if(e.stat.code===0&&e.content[0]&&e.stat.stateList[0].code===0)return!0;if(e.stat.code!=-180&&e.stat.code!=-360)return!1;if(t){var n=window.location.pathname;n!="/login.html"&&(window.location.href="/login.html")}},clean:function(e){return r.each(e,function(t,n,i){(r.isUndefined(t)||r.isNull(t))&&delete e[n]}),e},encrypt:function(e,t){r.each(e,function(t,n,i){r.isUndefined(t)&&delete e[n]});var n=[];r.each(e,function(e,t,r){n.push(t+"="+e)}),n.sort();var s=n.join("");return s+=t,i(s)},sign:function(e,t){var n=this,i={NONE:function(e,t){var n="sfhaitao.xyz!";return r.extend(e,{_sig:sf.util.encrypt(e,n)})},USERLOGIN:function(e,t){var i=s.get("csrfToken");if(i)return r.extend(e,{_sig:n.encrypt(e,i)});if(!t)return e;var o=window.location.pathname;o!="/login.html"&&(window.location.href="/login.html")}},o=i[e.level];if(r.isFunction(o)){var u=r.extend(e.data,{_aid:1,_sm:"md5"});return o(u)}return e.data}}}),define("sf.b2c.mall.component.header",["jquery","jquery.cookie","can","underscore","md5","store","sf.b2c.mall.component.login.status.scanner","sf.b2c.mall.framework.comm","sf.b2c.mall.api.user.getUserInfo","sf.b2c.mall.api.user.logout","sf.b2c.mall.widget.modal","sf.b2c.mall.business.config","sf.b2c.mall.widget.not.support","sf.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=1;return n.Control.extend({defaults:{login:{myOrder:c.setting.link.orderlist},nologin:{myOrder:c.setting.link.login}},init:function(t,i){this.component={},this.component.modal=new l("body"),this.component.scanner=new o,this.component.notSupport=new h("body"),this.watchLoginState.call(this),this.afterLoginDest=null;if(u.prototype.checkUserLogin.call(this)){var s=e.cookie(d+"_uinfo"),a=[];s&&(a=s.split(",")),this.data=new n.Map(r.extend(this.defaults.login,{isUserLogin:!0,index:c.setting.link.index,nickname:a[0]}))}else this.data=new n.Map(r.extend(this.defaults.nologin,{isUserLogin:!1,index:c.setting.link.index,nickname:null}));this.render(this.data);if(this.options.isForceLogin){var f=this;u.prototype.checkUserLogin.call(f)||(window.location.href=c.setting.link.index)}},render:function(e){var t=n.view("templates/component/sf.b2c.mall.header.mustache",e);this.element.html(t)},"#user-setting click":function(e,t){t&&t.preventDefault()},"#user-orderlist click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.orderlist+window.location.search+window.location.hash:this.showLogin("orderlist")},"#user-password-change click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.passwordchange:this.showLogin("passwordchange")},"#user-center click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.center:this.showLogin("center")},"#user-logout click":function(e,t){t&&t.preventDefault();var n=this;if(u.prototype.checkUserLogin.call(this)){var r=new f({});r.sendRequest().done(function(e){n.data.attr("user",null),s.remove("csrfToken"),setTimeout(function(){window.location.href=c.setting.link.index},2e3)}).fail(function(){})}},"#my-account click":function(e,t){t&&t.preventDefault()},"#user-login click":function(e,t){t&&t.preventDefault(),this.showLogin()},"#user-register click":function(e,t){t&&t.preventDefault(),this.showRegister()},showRegister:function(e){if(p.isMobile.any())return window.location.href=c.setting.link.iregister;e&&(this.afterLoginDest=e),this.component.modal.show({title:"登录顺丰海淘",html:'<iframe height="535px" width="100%" frameborder="no" seamless="" src="'+c.setting.link.register+'"></iframe>'})},showLogin:function(e){if(p.isMobile.any())return window.location.href=c.setting.link.ilogin;e&&(this.afterLoginDest=e),this.component.modal.show({title:"登录顺丰海淘",html:'<iframe height="535px" width="100%" frameborder="no" seamless="" src="'+c.setting.link.login+'"></iframe>'}),this.component.modal.setTitle("顺丰海淘")},watchLoginState:function(){var t=this;setInterval(function(){t.component.modal.isClosed()&&(t.afterLoginDest=null);if(u.prototype.checkUserLogin.call(t)){t.component.modal.isClosed()||t.component.modal.hide();if(t.afterLoginDest){var n=c.setting.link[t.afterLoginDest]||t.afterLoginDest;window.location.href=n}var r=e.cookie(d+"_uinfo"),i=[];r&&(i=r.split(",")),t.data.attr("isUserLogin",!0),t.data.attr("nickname",i[0])}else t.data.attr("isUserLogin",!1),t.data.attr("nickname",null)},500)}})}),define("sf.b2c.mall.component.footer",["can"],function(e){return e.Control.extend({init:function(t,n){var r=e.view("templates/component/sf.b2c.mall.footer.mustache")({});this.element.html(r)}})}),define("sf.b2c.mall.widget.message",["jquery","can"],function(e,t){return t.Control.extend({init:function(e,t){this.data={},this.data.type=this.options.type,this.data.tip=this.options.tip,this.data.okFunction=typeof this.options.okFunction!="undefined"?this.options.okFunction:null,this.data.closeFunction=typeof this.options.closeFunction!="undefined"?this.options.closeFunction:null,this.data.buttons=this.buttonsMap[this.data.type],this.render()},render:function(){this.setup(e("body")),this.options.html=t.view("templates/widget/sf.b2c.mall.widget.message.mustache",this.data),e("body").append(this.options.html)},buttonsMap:{confirm:'<a href="javascript:void(0)" class="btn btn-send" id="ok">确定</a><a href="javascript:void(0)" class="btn btn-cancel" id="cancel">取消</a>',error:'<a href="javascript:void(0)" class="btn btn-send" id="ok">确定</a>',success:'<a href="javascript:void(0)" class="btn btn-send" id="ok">确定</a>'},"#close click":function(){return this.close(),!1},"#ok click":function(){return typeof this.data.okFunction!="undefined"&&this.data.okFunction!=null&&this.data.okFunction.apply(this),this.close(),!1},"#cancel click":function(){return typeof this.data.closeFunction!="undefined"&&this.data.closeFunction!=null&&this.data.closeFunction.apply(this),this.close(),!1},close:function(){e("#messagedialog").remove(),this.destroy()}})}),define("sf.b2c.mall.center.change.userinfo",["can","jquery","jquery.cookie","sf.b2c.mall.api.user.getUserInfo","sf.b2c.mall.api.user.updateUserInfo","sf.b2c.mall.widget.message"],function(e,t,n,r,i,s){var o={INVALID_GENDER:"男",MALE:"男",FEMALE:"女"},u=1;return e.Control.extend({init:function(){this.component={},this.component.updateUserInfo=new i,this.component.getUserInfo=new r;var t=this;this.component.getUserInfo.sendRequest().done(function(n){t.data=new e.Map({isModified:!1,user:{nick:n.nick,gender:o[n.gender]},input:{nick:n.nick,gender:n.gender}}),t.render(t.data)}).fail(function(e){throw new Error(e)})},render:function(t){var n=e.view("templates/center/sf.b2c.mall.center.userinfo.mustache",t);this.element.html(n)},"#user-info-modify-btn click":function(e,t){t&&t.preventDefault(),this.data.isModified||this.data.attr("isModified",!0)},"#select-sex change":function(e,t){this.data.input.attr("gender")},"#user-info-confirm-btn click":function(e,t){t&&t.preventDefault();if(this.data.isModified){var n=this.data.input.attr("nick"),r=n.indexOf(",");if(r>=0)return window.alert("您的昵称中有非法字符"),!1;if(n.length>10)return window.alert("您的昵称太长，请返回修改"),!1;var i={gender:this.data.input.attr("gender"),nick:this.data.input.attr("nick")},u=this;this.component.updateUserInfo.setData(i),this.component.updateUserInfo.sendRequest().done(function(e){if(e.value){var t=u.data.input.attr("nick"),n=u.data.input.attr("gender");u.data.user.attr({nick:t,gender:o[n]}),u.data.attr("isModified",!1);var r=new s(null,{tip:"修改资料成功！",type:"success"})}}).fail(function(){u.data.attr("isModified",!1)})}}})}),define("sf.b2c.mall.component.receivepersoneditor",["can","sf.b2c.mall.api.user.createReceiverInfo","sf.b2c.mall.api.user.updateReceiverInfo","sf.b2c.mall.widget.message","placeholders"],function(e,t,n,r,i){return e.Control.extend({init:function(){this.adapter={},this.onSuccess=this.options.onSuccess},idErrorMap:{1000200:"该身份证信息已存在！",1000280:"身份证号码错误！"},render:function(t,n,r){this.setup(r);var i=e.view("templates/component/sf.b2c.mall.component.receivepersoneditor.mustache",t);r.html(i)},show:function(t,n,r){var i={create:function(e){return{input:{recId:null,recName:null,type:"ID",credtNum:null},mainTitle:{text:"添加收货人信息"},cancle:{text:"取消添加"},error:{recName:null,credtNum:null}}},editor:function(e){return{input:{recId:e.recId,recName:e.recName,type:"ID",credtNum:e.credtNum},mainTitle:{text:"修改收货人信息"},cancle:{text:"取消修改"},error:{recName:null,credtNum:null}}}},s=i[t].call(this,n);this.adapter.person=new e.Map(s),this.render(this.adapter,t,r)},hide:function(){this.destroy()},"#center-add-address-cancel-btn click":function(e,t){t&&t.preventDefault(),this.element.empty()},add:function(n){var i=e.Deferred(),s=this,o=new t(n);return o.sendRequest().done(function(e){var t=new r(null,{tip:"新增收货人成功！",type:"success"});i.resolve(e),s.onSuccess(e)}).fail(function(e){e===1000310&&new r(null,{tip:"您已添加20条收货人信息，请返回修改！",type:"error"}),i.reject(e)}),i},update:function(t){var r=e.Deferred(),i=this,s=new n(t);return s.sendRequest().done(function(e){r.resolve(e),i.onSuccess()}).fail(function(e){r.reject(e)}),r},"#personSaveCancel click":function(e,t){return this.element.hide(),this.element.empty(),$("#btn-add-person").show(),!1},"#recRealName focus":function(e,t){t&&t.preventDefault(),$("#recnameerror").hide()},"#identity focus":function(e,t){t&&t.preventDefault(),$("#credtnumerror").hide()},"#personSave click":function(t,n){n&&n.preventDefault(),$("#recnameerror").hide(),$("#credtnumerror").hide();var r=this.adapter.person.input.attr(),i;for(i in r)r[i]=_.str.trim(r[i]);if(!r.recName)return this.adapter.person.attr("error",{recName:"请填写收货人姓名！"}),$("#recnameerror").show(),!1;var s=/^[\u4e00-\u9fa5]{0,10}$/.test($.trim(r.recName));if(!s)return this.adapter.person.attr("error",{recName:"请填写身份证上真实姓名"}),$("#recnameerror").show(),!1;if(!r.credtNum)return this.adapter.person.attr("error",{credtNum:"请填写收货人身份证号码！"}),$("#credtnumerror").show(),!1;if(r.credtNum.length<18||r.credtNum.length>18)return this.adapter.person.attr("error",{credtNum:"收货人身份证号码填写有误！"}),$("#credtnumerror").show(),!1;var o={},u=r.credtNum;if(u.length==18){var a=u.substring(6,10),f=u.substring(10,12),l=u.substring(12,14),c=u.substring(14,17),h=new Date(a,parseFloat(f)-1,parseFloat(l));if(h.getFullYear()!=parseFloat(a)||h.getMonth()!=parseFloat(f)-1||h.getDate()!=parseFloat(l))o.isTrue=!1;var p=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1],d=[1,0,10,9,8,7,6,5,4,3,2],v=0,m=u.split("");m[17].toLowerCase()=="x"&&(m[17]=10);for(var g=0;g<17;g++)v+=p[g]*m[g];var g=v%11;m[17]!=d[g]?o.isTrue=!1:o.isTrue=!0,o.year=h.getFullYear(),o.month=h.getMonth()+1,o.day=h.getDate(),c%2==0?(o.isFemale=!0,o.isMale=!1):(o.isFemale=!1,o.isMale=!0)}if(!o.isTrue)return this.adapter.person.attr("error",{credtNum:"收货人身份证号码填写有误！"}),$("#credtnumerror").show(),!1;var y=this;if(r.recId){var b=this.update(r);b.done(function(e){t.parents("div#editPersonArea").toggle()}).fail(function(e){return y.idErrorMap[e]&&(y.adapter.person.attr("error",{credtNum:y.idErrorMap[e]}),$("#credtnumerror")[0].style.display="inline"),!1})}else{var w=e.deparam(window.location.search.substr(1));w.saleid=="heike_online"&&!_.isEmpty(w.orgCode)&&(r.partnerId="heike");var b=this.add(r);b.done(function(e){r.recId=e.value,t.parents("div#addPersonArea").toggle(),$("#btn-add-person").show()}).fail(function(e){return y.idErrorMap[e]&&(y.adapter.person.attr("error",{credtNum:y.idErrorMap[e]}),$("#credtnumerror").show()),!1})}}})}),define("sf.b2c.mall.adapter.receiveperson.list",["can"],function(e){return e.Map({init:function(e){this.attr("input",{recId:this.findDefaultPerson()})},findDefaultPerson:function(){if(this.personList){var e=this.personList.attr("0");return e&&e.addrId}},remove:function(e){this.personList.removeAttr(e)},get:function(e){return this.personList.attr(e)},length:function(){return this.personList.attr("length")}})}),define("sf.b2c.mall.center.receiveperson",["can","jquery","sf.b2c.mall.api.user.getIDCardUrlList","sf.b2c.mall.api.user.webLogin","sf.b2c.mall.component.receivepersoneditor","md5","sf.b2c.mall.framework.comm","sf.b2c.mall.adapter.receiveperson.list","sf.b2c.mall.api.user.delRecvInfo","sf.b2c.mall.widget.message"],function(e,t,n,r,i,s,o,u,a,f){return o.register(1),e.Control.extend({init:function(e,t){this.adapter4List={},this.component={},this.component.getIDCardUrlList=new n,this.component.delRecvInfo=new a,this.paint()},helpers:{isover:function(t,n){var r=t();if(r&&r.length>15){var i="已保存了"+r.length+"条收货人，还能保存"+(20-r.length)+"条收货人。";return n.fn(new e.Map({errorText:i}))}return n.inverse(n.contexts||this)}},render:function(t){var n=e.view("templates/center/sf.b2c.mall.center.receiveperson.mustache",t,this.helpers);this.element.html(n)},paint:function(){var e=this;this.component.getIDCardUrlList.sendRequest().done(function(t){e.adapter4List.persons=new u({personList:t.items,hasData:!1}),e.adapter4List.persons.personList!=null&&e.adapter4List.persons.personList.length>0&&e.adapter4List.persons.attr("hasData",!0),e.render(e.adapter4List.persons),e.component.personEditor=new i("#addPersonArea",{onSuccess:_.bind(e.paint,e)})}).fail(function(e){})},".order-edit click":function(e,n){n&&n.preventDefault();var r=e.data("index"),i=this.adapter4List.persons.get(r);this.adapter4List.persons.input.attr("recId",i.recId),t("#editPersonArea").hide(),t("#addPersonArea").hide();var s=e.parents("li[name='personEach']").find("#editPersonArea");return s.show(),this.component.personEditor.show("editor",i,t(s)),!1},".order-del click":function(e,t){t&&t.preventDefault();var n=e.data("index"),r=this.adapter4List.persons.get(n),i=this,s=new f(null,{tip:"确认要删除该收货人“"+r.recName+"”的信息吗？",type:"confirm",okFunction:_.bind(i.delPerson,i,e,r)})},delPerson:function(e,t){this.adapter4List.persons.input.attr("recId",t.recId);var n=this;this.component.delRecvInfo.setData({recId:t.recId}),this.component.delRecvInfo.sendRequest().done(function(e){e.value&&n.paint()}).fail(function(e){})},".btn-add click":function(e,n){return t("#editPersonArea").hide(),t("#addPersonArea").show(),t(e).hide(),this.component.personEditor.show("create",null,t("#addPersonArea")),!1},showTemplate:function(){return'<div class="mask"></div><div class="dialog dialog-center"><a href="#" class="btn btn-close">关闭</a>{{#confirmText}}<p>确定要删除收货人“{{username}}”的信息吗？</p>{{/confirmText}}{{^confirmText}}<p>确定要删除此收货地址吗？</p>{{/confirmText}}<div class="dialog-r1"><a id="btn-del" href="#" class="btn btn-send">确定</a><a id="btn-cancel" href="#" class="btn btn-cancel">取消</a></div></div>'}})}),define("sf.b2c.mall.adapter.address.list",["can"],function(e){return e.Map({init:function(e){this.attr("input",{addrId:this.findDefaultAddress()})},findDefaultAddress:function(){var e=this.addressList.attr("0");return e&&e.addrId},remove:function(e){this.addressList.removeAttr(e)},get:function(e){return this.addressList.attr(e)},length:function(){return this.addressList.attr("length")}})}),define("sf.b2c.mall.adapter.regions",["can"],function(e){return e.Map({findOne:function(e){var t=this.attr("cityList");return _.findWhere(t,{id:e})},findGroup:function(e){var t=this.attr("cityList");return _.filter(t,function(t,n,r){return t.superregion_id==e})},getIdByName:function(e){var t=this.cityList.attr(),n=_.findWhere(t,{name:e});return n.id},getIdBySuperreginIdAndName:function(e,t){var n=this.cityList.attr(),r=_.findWhere(n,{superregion_id:e,name:t});return r.id},getGroupByName:function(e){var t=this.getIdByName(e);return this.findGroup(t)},findOneName:function(e){if(e&&this.findOne(e)){var t=this.findOne(e);return t.name}}})}),define("sf.b2c.mall.component.addreditor",["can","sf.b2c.mall.adapter.regions","sf.b2c.mall.api.user.createRecAddress","sf.b2c.mall.api.user.updateRecAddress","placeholders","sf.b2c.mall.widget.message"],function(e,t,n,r,i,s){return e.Control.extend({init:function(){this.adapter={},this.request(),this.onSuccess=this.options.onSuccess},request:function(){var n=this;return e.ajax("json/sf.b2c.mall.regions.json").done(_.bind(function(e){this.adapter.regions=new t({cityList:e})},this)).fail(function(){})},render:function(t,n,r){this.setup(r);var i=e.view("templates/component/sf.b2c.mall.component.addreditor.mustache",t);r.html(i),this.supplement(n)},supplement:function(e){e=="create"&&(this.changeCity(),this.changeRegion())},show:function(e,t,n){var r=this;this.adapter.regions?r._show.call(r,e,t,n):this.request().then(function(){r._show.call(r,e,t,n)})},_show:function(t,n,r){var i={create:function(e){return{input:{addrId:null,nationName:"0",provinceName:this.adapter.regions.findGroup(0)[0].id,cityName:null,regionName:null,detail:null,recId:null,cellphone:null,zipCode:null},place:{countries:[{id:0,name:"中国"}],provinces:this.adapter.regions.findGroup(0),cities:null,regions:null},control:{add:!1},mainTitle:{text:"添加收货地址"},cancle:{text:"取消添加"},error:{detail:null,zipCode:null,cellphone:null}}},editor:function(e){var t=this.adapter.regions.getIdByName(e.provinceName),n=this.adapter.regions.getIdBySuperreginIdAndName(t,e.cityName);return{input:{addrId:e.addrId,nationName:0,provinceName:t,cityName:n,regionName:this.adapter.regions.getIdBySuperreginIdAndName(n,e.regionName),detail:e.detail,cellphone:e.cellphone,zipCode:e.zipCode,recId:e.recId},place:{countries:[{id:0,name:"中国"}],provinces:this.adapter.regions.findGroup(0),cities:this.adapter.regions.getGroupByName(e.provinceName),regions:this.adapter.regions.getGroupByName(e.cityName)},control:{add:!1},mainTitle:{text:"修改收货地址"},cancle:{text:"取消修改"},error:{detail:null,zipCode:null,cellphone:null}}}},s=i[t].call(this,n);this.adapter.addr=new e.Map(s),this.render(this.adapter,t,r)},hide:function(){this.destroy()},clearComponents:function(){this.component.idList&&this.component.idList.destroy(),this.component.idEditor&&this.component.idEditor.destroy()},changeCity:function(){var e=this.adapter.addr.input.attr("provinceName"),t=this.adapter.regions.findGroup(window.parseInt(e));this.adapter.addr.place.attr("cities",t),this.adapter.addr.input.attr("cityName",t[0].id)},changeRegion:function(){var e=this.adapter.addr.input.attr("cityName"),t=this.adapter.regions.findGroup(window.parseInt(e));this.adapter.addr.place.attr("regions",t),this.adapter.addr.input.attr("regionName",t[0].id)},"#s2 change":function(e,t){this.changeCity(),this.changeRegion()},"#s3 change":function(e,t){this.changeRegion()},"#center-add-address-cancel-btn click":function(e,t){t&&t.preventDefault(),this.element.empty()},add:function(t){var r=this;delete t.recId;var i=e.deparam(window.location.search.substr(1));i.saleid=="heike_online"&&!_.isEmpty(i.orgCode)&&(t.partnerId="heike");var o=new n(t);o.sendRequest().done(function(e){var t=new s(null,{tip:"新增收货地址成功！",type:"success"});return r.hide(),r.onSuccess(e),!0}).fail(function(e){return e===1000310&&new s(null,{title:"顺丰海淘",tip:"您已添加20条收货地址信息，请返回修改！",type:"error"}),!1})},update:function(e){var t=this,n=new r(e);n.sendRequest().done(function(n){var r=new s(null,{tip:"修改收货地址成功！",type:"success"});t.hide(),t.onSuccess({value:window.parseInt(e.addrId)})}).fail(function(e){})},"#paddressSaveCancel click":function(e,t){return this.element.hide(),this.element.empty(),$("#btn-add-addr").show(),!1},"#address focus":function(e,t){t&&t.preventDefault(),$("#detailerror").hide()},"#cellphone focus":function(e,t){t&&t.preventDefault(),$("#cellphoneerror").hide()},"#zipcode focus":function(e,t){t&&t.preventDefault(),$("#zipcodeerror").hide()},"#addressSave click":function(e,t){t&&t.preventDefault(),$(".tel-hide").hide();var n=this.adapter.addr.input.attr(),r;for(r in n)n[r]=_.str.trim(n[r]);n.nationName="中国",n.provinceName=this.adapter.regions.findOneName(window.parseInt(n.provinceName)),n.cityName=this.adapter.regions.findOneName(window.parseInt(n.cityName)),n.regionName=this.adapter.regions.findOneName(window.parseInt(n.regionName)),$("#detailerror").hide(),$("#cellphoneerror").hide(),$("#zipcodeerror").hide();if(!n.detail)return this.adapter.addr.attr("error",{detail:"请填写详细地址信息！"}),$("#detailerror").show(),!1;if(n.detail.length>120||n.detail.length<5)return this.adapter.addr.attr("error",{detail:"请输入正确地址信息!"}),$("#detailerror").show(),!1;if(!n.cellphone)return this.adapter.addr.attr("error",{cellphone:"请填写收货人手机号码！"}),$("#cellphoneerror").show(),!1;if(!/^1\d{10}$/.test(n.cellphone))return this.adapter.addr.attr("error",{cellphone:"收货人手机号码填写有误！"}),$("#cellphoneerror").show(),!1;if(!n.zipCode)return this.adapter.addr.attr("error",{zipCode:"请填写邮编！"}),$("#zipcodeerror").show(),!1;var i=/[0-9]\d{5}(?!\d)$/.test($.trim(n.zipCode));if(!i||n.zipCode.length>6)return this.adapter.addr.attr("error",{zipCode:"邮编填写有误！"}),$("#zipcodeerror").show(),!1;if(n.addrId)this.update(n),e.parents("div#editAdrArea").toggle();else{var s=this.add(n);s&&(e.parents("div#addAdrArea").toggle(),$("#btn-add-addr").show())}}})}),define("sf.b2c.mall.center.receiveaddr",["can","jquery","sf.b2c.mall.api.user.getRecAddressList","sf.b2c.mall.adapter.address.list","sf.b2c.mall.component.addreditor","sf.b2c.mall.api.user.webLogin","md5","sf.b2c.mall.framework.comm","sf.b2c.mall.api.user.delRecAddress","sf.b2c.mall.widget.message"],function(e,t,n,r,i,s,o,u,a,f){return u.register(1),e.Control.extend({init:function(e,t){this.adapter4List={},this.component={},this.component.getRecAddressList=new n,this.paint()},helpers:{isover:function(t,n){var r=t();if(r&&r.length>15){var i="已保存了"+r.length+"条收货地址，还能保存"+(20-r.length)+"条收货地址。";return n.fn(new e.Map({errorText:i}))}return n.inverse(n.contexts||this)}},render:function(t){var n=e.view("templates/center/sf.b2c.mall.center.receiveaddr.mustache",t,this.helpers);this.element.html(n)},paint:function(){var e=this;this.component.getRecAddressList.sendRequest().fail(function(e){}).done(function(t){e.adapter4List.addrs=new r({addressList:t.items,hasData:!1}),e.adapter4List.addrs.addressList!=null&&e.adapter4List.addrs.addressList.length>0&&e.adapter4List.addrs.attr("hasData",!0),e.render(e.adapter4List.addrs),e.component.addressEditor=new i("#addAdrArea",{onSuccess:_.bind(e.paint,e)})})},getCityList:function(){return e.ajax("json/sf.b2c.mall.regions.json")},".order-edit click":function(e,n){var r=e.data("index"),i=this.adapter4List.addrs.get(r);this.adapter4List.addrs.input.attr("addrId",i.addrId),t("#editAdrArea").hide(),t("#addAdrArea").hide();var s=e.parents("li[name='addrEach']").find("#editAdrArea");return s.show(),this.component.addressEditor.show("editor",i,t(s)),!1},".order-del click":function(e,t){var n=e.data("index"),r=this.adapter4List.addrs.get(n),i=this,s=new f(null,{tip:"确认要删除该收货地址信息吗？",type:"confirm",okFunction:_.bind(i.delAddress,i,e,r)});return!1},delAddress:function(e,t){var n=this,r=new a({addrId:t.addrId});r.sendRequest().done(function(e){e.value&&n.paint()}).fail(function(e){})},".btn-add click":function(e,n){return t("#editAdrArea").hide(),t("#addAdrArea").show(),t(e).hide(),this.component.addressEditor.show("create",null,t("#addAdrArea")),!1}})}),define("sf.b2c.mall.page.center",["can","jquery","sf.b2c.mall.component.header","sf.b2c.mall.component.footer","sf.b2c.mall.center.change.userinfo","sf.b2c.mall.center.receiveperson","sf.b2c.mall.center.receiveaddr","sf.b2c.mall.framework.comm"],function(e,t,n,r,i,s,o,u){u.register(1);var a=e.Control.extend({init:function(){this.render(),this.supplement()},render:function(){new n(".sf-b2c-mall-header",{isForceLogin:!0}),new r(".sf-b2c-mall-footer"),new i(".user-basic-info"),new s(".sf-b2c-mall-center-personmanager"),new o(".sf-b2c-mall-center-addressmanager")},supplement:function(){t(".btn-select").on("click",function(){t(this).hasClass("active")?(t(this).removeClass("active"),t(this).find("ul").hide()):(t(this).addClass("active"),t(this).find("ul").show())}),t(".btn-select").on("click","label",function(){var e=t(this).parents(".btn-select");e.removeClass("active");var n=t(this).text();return e.find(".btn-select-num").text(n),e.find("ul").hide(),!1})}});new a(".center")}),require(["sf.b2c.mall.page.center"]);