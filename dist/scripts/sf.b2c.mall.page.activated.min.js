define("sf.b2c.mall.component.login.status.scanner",["jquery","can","underscore","store"],function(e,t,n,r){return t.Control.extend({init:function(e,t){this.userLogin=!1,this.insertScanner(),this.setScanner()},insertScanner:function(){e("#proxy").length==0&&e("body").append('<iframe id="proxy" src="http://www.sfht.com/proxy.html" style="display:none;"></iframe>')},setScanner:function(){window.postMessage?this.setPostMesageScanner():this.setWindowNameScanner()},setCsrfToken:function(e){if(e)try{var t=JSON.parse(e.data),n=r.get("csrfToken");n!=t.csrfToken&&r.set("csrfToken",t.csrfToken)}catch(i){throw i}},setPostMesageScanner:function(){window.onmessage=function(){if(event)try{var e=JSON.parse(event.data),t=r.get("csrfToken");t!=e.csrfToken&&r.set("csrfToken",e.csrfToken)}catch(n){throw n}}},setWindowNameScanner:function(){var t=this;this.handler=setInterval(function(){try{var i=e("#proxy").get(0)&&e("#proxy").get(0).contentWindow.name;i&&(r.set("csrfToken",i),this.userStatus!=1&&n.isFunction(t.options.changeStatus)&&t.options.changeStatus(!0))}catch(s){}},500)}})}),define("sf.b2c.mall.widget.modal",["jquery","underscore","can"],function(e,t,n){return n.Control.extend({init:function(e,t){this.modalid=(new Date).valueOf()},show:function(e){e=t.extend(e,{id:this.modalid});var r=n.view.mustache(e&&e.template||this.template());this.element.append(r(e||this.options)),this.element.find(".modal#"+this.modalid+" .mask").show()},hide:function(){this.element.find("#"+this.modalid).remove(),this.closed=!0},isClosed:function(){return this.closed},template:function(){return'<div class="modal" id="{{id}}"><div class="mask"></div><div class="register"><div class="register-h"><h2>{{title}}</h2><a href="#" class="btn btn-close">关闭</a><span class="icon icon34"></span><span class="icon icon35"></span></div><div class="">{{&html}}</div></div></div>'},".btn-close click":function(e,t){t&&t.preventDefault(),this.hide()},setTitle:function(e){this.element.find(".register-h h2").text(e)}})}),define("sf.b2c.mall.widget.not.support",["jquery","can"],function(e,t){return t.Control.extend({init:function(){(this.isIE(6)||this.isIE(7))&&this.render()},isIE:function(e){var t=document.createElement("b");return t.innerHTML="<!--[if IE "+e+"]><i></i><![endif]-->",t.getElementsByTagName("i").length===1},".btn-close click":function(t,n){e(".u-dialog-browser").remove(),e(".mask").remove()},render:function(){var e=t.view("templates/widget/sf.b2c.mall.widget.not.support.mustache",{});this.element.prepend(e)}})}),define("sf.util",["jquery","jquery.cookie","can","underscore","md5","store"],function(e,t,n,r,i,s){return n.route.ready(),{checkEmail:function(e){return/^([a-zA-Z0-9-_]*[-_\.]?[a-zA-Z0-9]+)*@([a-zA-Z0-9]*[-_]?[a-zA-Z0-9]+)+[\.][a-zA-Z]{2,3}([\.][a-zA-Z]{2})?$/.test(e)},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},Firefox:function(){return navigator.userAgent.indexOf("Firefox")>-1},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()||this.Firefox()}},isLogin:function(){return e.cookie("ct")==1?!0:!1},namespace:function(e){var t=e.split("."),n=sf;for(var r=0;r<t.length;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]];return n},access:function(e,t){if(e.stat.code===0&&e.content[0]&&e.stat.stateList[0].code===0)return!0;if(e.stat.code!=-180&&e.stat.code!=-360)return!1;if(t){var n=window.location.pathname;n!="/login.html"&&(window.location.href="/login.html")}},clean:function(e){return r.each(e,function(t,n,i){(r.isUndefined(t)||r.isNull(t))&&delete e[n]}),e},encrypt:function(e,t){r.each(e,function(t,n,i){r.isUndefined(t)&&delete e[n]});var n=[];r.each(e,function(e,t,r){n.push(t+"="+e)}),n.sort();var s=n.join("");return s+=t,i(s)},sign:function(e,t){var n=this,i={NONE:function(e,t){var n="sfhaitao.xyz!";return r.extend(e,{_sig:sf.util.encrypt(e,n)})},USERLOGIN:function(e,t){var i=s.get("csrfToken");if(i)return r.extend(e,{_sig:n.encrypt(e,i)});if(!t)return e;var o=window.location.pathname;o!="/login.html"&&(window.location.href="/login.html")}},o=i[e.level];if(r.isFunction(o)){var u=r.extend(e.data,{_aid:1,_sm:"md5"});return o(u)}return e.data}}}),define("sf.b2c.mall.component.header",["jquery","jquery.cookie","can","underscore","md5","store","sf.b2c.mall.component.login.status.scanner","sf.b2c.mall.framework.comm","sf.b2c.mall.api.user.getUserInfo","sf.b2c.mall.api.user.logout","sf.b2c.mall.widget.modal","sf.b2c.mall.business.config","sf.b2c.mall.widget.not.support","sf.util"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=1;return n.Control.extend({defaults:{login:{myOrder:c.setting.link.orderlist},nologin:{myOrder:c.setting.link.login}},init:function(t,i){this.component={},this.component.modal=new l("body"),this.component.scanner=new o,this.component.notSupport=new h("body"),this.watchLoginState.call(this),this.afterLoginDest=null;if(u.prototype.checkUserLogin.call(this)){var s=e.cookie(d+"_uinfo"),a=[];s&&(a=s.split(",")),this.data=new n.Map(r.extend(this.defaults.login,{isUserLogin:!0,index:c.setting.link.index,nickname:a[0]}))}else this.data=new n.Map(r.extend(this.defaults.nologin,{isUserLogin:!1,index:c.setting.link.index,nickname:null}));this.render(this.data);if(this.options.isForceLogin){var f=this;u.prototype.checkUserLogin.call(f)||(window.location.href=c.setting.link.index)}},render:function(e){var t=n.view("templates/component/sf.b2c.mall.header.mustache",e);this.element.html(t)},"#user-setting click":function(e,t){t&&t.preventDefault()},"#user-orderlist click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.orderlist+window.location.search+window.location.hash:this.showLogin("orderlist")},"#user-password-change click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.passwordchange:this.showLogin("passwordchange")},"#user-center click":function(e,t){t&&t.preventDefault(),u.prototype.checkUserLogin.call(this)?window.location.href=c.setting.link.center:this.showLogin("center")},"#user-logout click":function(e,t){t&&t.preventDefault();var n=this;if(u.prototype.checkUserLogin.call(this)){var r=new f({});r.sendRequest().done(function(e){n.data.attr("user",null),s.remove("csrfToken"),setTimeout(function(){window.location.href=c.setting.link.index},2e3)}).fail(function(){})}},"#my-account click":function(e,t){t&&t.preventDefault()},"#user-login click":function(e,t){t&&t.preventDefault(),this.showLogin()},"#user-register click":function(e,t){t&&t.preventDefault(),this.showRegister()},showRegister:function(e){if(p.isMobile.any())return window.location.href=c.setting.link.iregister;e&&(this.afterLoginDest=e),this.component.modal.show({title:"登录顺丰海淘",html:'<iframe height="535px" width="100%" frameborder="no" seamless="" src="'+c.setting.link.register+'"></iframe>'})},showLogin:function(e){if(p.isMobile.any())return window.location.href=c.setting.link.ilogin;e&&(this.afterLoginDest=e),this.component.modal.show({title:"登录顺丰海淘",html:'<iframe height="535px" width="100%" frameborder="no" seamless="" src="'+c.setting.link.login+'"></iframe>'}),this.component.modal.setTitle("顺丰海淘")},watchLoginState:function(){var t=this;setInterval(function(){t.component.modal.isClosed()&&(t.afterLoginDest=null);if(u.prototype.checkUserLogin.call(t)){t.component.modal.isClosed()||t.component.modal.hide();if(t.afterLoginDest){var n=c.setting.link[t.afterLoginDest]||t.afterLoginDest;window.location.href=n}var r=e.cookie(d+"_uinfo"),i=[];r&&(i=r.split(",")),t.data.attr("isUserLogin",!0),t.data.attr("nickname",i[0])}else t.data.attr("isUserLogin",!1),t.data.attr("nickname",null)},500)}})}),define("sf.b2c.mall.component.footer",["can"],function(e){return e.Control.extend({init:function(t,n){var r=e.view("templates/component/sf.b2c.mall.footer.mustache")({});this.element.html(r)}})}),define("sf.b2c.mall.page.activated",["jquery","can","underscore","md5","store","sf.b2c.mall.framework.comm","sf.b2c.mall.component.header","sf.b2c.mall.component.footer","sf.b2c.mall.api.user.mailRegister","sf.b2c.mall.business.config"],function(e,t,n,r,i,s,o,u,a,f){s.register(1);var l="密码请设置6-18位字母、数字或标点符号",c="两次填写的密码不一致",h={1000020:"账户已注册",1000050:"邮箱地址错误",1000070:"参数错误",1000120:"链接已过期",1000130:"签名验证失败"},p=t.Control.extend({init:function(){this.component={},this.component.mailRegister=new a,this.paint()},paint:function(){this.component.header=new o(".sf-b2c-mall-header"),this.component.footer=new u(".sf-b2c-mall-footer");var e=t.deparam(window.location.search.substr(1));this.data=new t.Map({link:window.location.search.substr(1),email:e.mailId,repassword:null,password:null,errorText:null}),this.render(this.data)},render:function(e){var n=t.view.mustache(this.template());this.element.find(".sf-b2c-mall-content").html(n(e))},"#input-password focus":function(e,t){this.data.attr("errorText",null)},"#input-repassword focus":function(e,t){this.data.attr("errorText",null)},"#input-password blur":function(e,t){var n=this.data.attr("password");if(!/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(n))return this.data.attr("errorText",l)},"#input-repassword blur":function(e,t){var r=this.data.attr("repassword"),i=this.data.attr("password");if(!/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(i))return this.data.attr("errorText",l);if(n.isEmpty(r)||i!==r)return this.data.attr("errorText",c)},".btn-send click":function(e,t){t&&t.preventDefault();var s=this.data.attr("password"),o=this.data.attr("repassword"),u=this.data.attr("email"),a=this.data.attr("link");if(!/^[0-9a-zA-Z~!@#\$%\^&\*\(\)_+=-\|~`,./<>\[\]\{\}]{6,18}$/.test(s))return this.data.attr("errorText",l);if(n.isEmpty(o)||s!==o)return this.data.attr("errorText",c);this.component.mailRegister.setData({mailId:u,passWord:r(s+f.setting.md5_key),linkContent:window.decodeURIComponent(a)});var p=this;this.component.mailRegister.sendRequest().done(function(e){e.csrfToken&&(i.set("csrfToken",e.csrfToken),window.location.href="index.html")}).fail(function(e){if(n.isNumber(e)){var t=h[e.toString()];p.data.attr("errorText",t)}})},template:function(){return'<div class="pb"><div class="pm"><div class="order verification"><h1><span class="icon icon36"></span>恭喜你，账户验证成功，请设置登录密码。</h1><ol><li><label for="">登录邮箱：</label>{{email}}</li><li><label for="password">设置密码：</label><input type="password" class="input" id="input-password" can-value="password" placeholder=""><p>6-18位字母、数字或标点符号</p></li><li><label for="repassword">重输密码：</label><input type="password" class="input" id="input-repassword" can-value="repassword" placeholder=""></li>{{#errorText}}<li style="padding-left: 88px;"><span class="icon icon26 error">{{errorText}}</span></li>{{/errorText}}</ol><a href="#" class="btn btn-send">确认</a><span class="icon icon28"></span></div></div></div>'}}),d=new p("body")}),require(["sf.b2c.mall.page.activated"]);